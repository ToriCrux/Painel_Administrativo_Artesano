name: ğŸ³ CD - Build & Push Docker Images

on:
  push:
    branches:
      - workflow     # ou "main", se quiser publicar direto da principal
  workflow_dispatch:

jobs:
  docker:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Checkout do cÃ³digo
      - name: ğŸ“¦ Checkout do cÃ³digo
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Login no Docker Hub
      - name: ğŸ” Login no Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # 3ï¸âƒ£ Build & Push do monÃ³lito (admin)
      - name: ğŸ§± Build & Push (Admin)
        uses: docker/build-push-action@v6
        with:
          context: ./admin
          push: true
          tags: ardovino/artesano-admin:latest

      # 4ï¸âƒ£ Build & Push do serviÃ§o de autenticaÃ§Ã£o
      - name: ğŸ” Build & Push (Auth Service)
        uses: docker/build-push-action@v6
        with:
          context: ./autenticacao-service
          push: true
          tags: ardovino/artesano-auth:latest

      # 5ï¸âƒ£ Build & Push do serviÃ§o de registro
      - name: ğŸ§¾ Build & Push (Registro Service)
        uses: docker/build-push-action@v6
        with:
          context: ./registro-service
          push: true
          tags: ardovino/artesano-registro:latest

      # 6ï¸âƒ£ FinalizaÃ§Ã£o
      - name: âœ… ConclusÃ£o
        run: echo "ğŸ‰ Todas as imagens foram publicadas com sucesso no Docker Hub!"
